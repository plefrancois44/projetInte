<!DOCTYPE html>
<html>
    <head>
    <script src="/static/jquery-3.2.1.js"></script>
    <link rel="stylesheet" href="static/form.css" />
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<?------------------------------------------------- GET------------------------->
    <script>
    

    function metrology(){
        $.ajax("/metrology")
            .done(function(data){
                $("#metrology").text(data)
            })
    }

    function $_GET(param) {
        var vars = {};
        window.location.href.replace( location.hash, '' ).replace( 
            /[?&]+([^=&]+)=?([^&]*)?/gi, // regexp
            function( m, key, value ) { // callback
                vars[key] = value !== undefined ? value : '';
            }
        );

        if ( param ) {
            return vars[param] ? vars[param] : null;    
        }
        return vars;
    }

    function envoyerDecision(simulated){
        var pseudo = $_GET('pseudo');
        let data = 
        {
            "simulated" : simulated,
            "actions" : 
            [{
                "kind": "drinks",
                "prepare": 
                [
                    {
                        "boisson" : "Limonade",
                        "quantite" : $("#nbLimonade").val()
                    },
                    {
                        "boisson" : "Chocolat_chaud",
                        "quantite" : $("#nbChocolat_chaud").val()
                    },
                    {
                        "boisson" : "Mojito",
                        "quantite" : $("#nbMojito").val()
                    }
                ],
                "price": 
                [
                    {
                        "boisson": "Limonade",
                        "prix" : $("#prixLimonade").val()
                    },
                    {
                        "boisson": "Chocolat_chaud",
                        "prix" : $("#prixChocolat_chaud").val()
                    },
                    {
                        "boisson": "Mojito",
                        "prix" : $("#prixMojito").val()
                    }
                ]
            }]
        };
        
        $.ajax("/actions/"+pseudo, {
          type: "POST",
          data: JSON.stringify(data),
          contentType: "application/json",
            }).done(function(data) {
                if(data["sufficentFunds"]!="True"){
                    $("#valideBoisson").text(data["totalCost"]);
                }
                else $("#valideBoisson").text("fond insuffisant");

                if(data["simulated"]!="True"){
                    window.alert('Décisions prises et bien envoyés au serveur.')
                } 
                else()
                    window.alert('Visualitation seulement')
            })       
        } 
    </script>
<?---------------------------------------------------------------------------------------------------->

    </head>
        <body>
                <?-- Titre de la page ------------------------------------------->
                <div id="main_title" class="jumbotron">
                    <h1>Lemonade Wars</h1>
                    <p>If you're not with me, you're my enemy...</p>                
                </div>
                <?--------------------------------------------------------------->


                    <div class="container">
                        <div class="row">
                            <div class="col-sm-4">
                                <h2>Situation actuelle:</h2>
                                    <label><input type="button" onclick="metrology()" name="metrology" value="Afficher le jour et l'heure"></input></label><br>
                                    <label id="metrology"> </label><br>                     
                                    <label><input type="button" onclick="meteo()"" name="meteo" value="Afficher la météo"></input></label><br>     
                                    <label id="meteo"> </label><br>                   
                                    <label><input type="button" onclick="budget()" name="budget" value="Afficher le budget"></input></label><br>
                                    <label id="budget"> </label><br>
                                    <label><input type="button" onclick="panneau()" name="panneau" value="Panneaux possédés"></input></label><br>
                                    <label id="panneau"> </label><br>
                            </div>        
                            <?------------------colum1------------------------------->

            		<div class="col-sm-5">
            			<h2>Décisions:</h2>
                        <form id="boisson">
                            <label id="boisson">Acheter boisson:</label><br>
                                <label value="Limonade">Limonade</label><br>
                                <label>Quantité : <input type='number' id="nbLimonade" placeholder="0"></label>
                                <label>Prix : <input type='number' id="prixLimonade" placeholder="0"></label><br>

                                <label value="Chocolat_chaud">Chocolat Chaud</label><br>
                                <label>Quantité : <input type='number' id="nbChocolat_chaud" placeholder="0"></label>
                                <label>Prix : <input type='number' id="prixChocolat_chaud" placeholder="0"></label><br>

                                <label value="Mojito">Mojito</label><br>
                                <label>Quantité : <input type='number' id="nbMojito" placeholder="0"></label>
                                <label>Prix : <input type='number' id="prixMojito" placeholder="0"></label><br>


                                <label><input type="button" onclick="envoyerDecision(true)" name="verifier" value="Visualiser ses choix"></input></label>

                        </form>
                        
            		    <form id="position">

                            <label>Acheter un panneau publicitaire:</label><br>
                            <div id="map" style="width:400px;height:400px;background:yellow"></div>

                                <script>
                                function myMap() {
                                var mapOptions = {
                                    center: new google.maps.LatLng(42.696792, 2.896178),
                                    zoom: 15,
                                    mapTypeId: google.maps.MapTypeId.HYBRID
                                }
                                var map = new google.maps.Map(document.getElementById("map"), mapOptions);
                                var marker = new google.maps.Marker({
                                    position: new google.maps.LatLng(42.696792, 2.896178),
                                    title:"Position de la pub",
                                    draggable:true

                                });

                                // To add the marker to the map, call setMap();
                                marker.setMap(map);

                                }
                                </script>
                                <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCTGI-jC0lAN0WTkOMaYhlDEUoJ-wGyfTI&callback=myMap" type="text/javascript"></script>


                            <label><input type="button" onclick="add_panneau()" name="add_panneau" value="+"></input></label>
                            <label>Améliorer le panneau:</label>
                            <label><input type="button" onclick="level_up()" name="level_up" value="+"></input></label>
                        </form>                
                        </div>

                        <div class="col-sm-3">
                                <h2>Facture:</h2>
								    <label>Total à payer: <label id="valideBoisson"> €</label></label><br>
								    <label id="validePosition"></label><br>

                                    <label><input type="button" onclick="envoyerDecision(false)" name="envoyerDecision" value="Valider mes choix"></input></label>


                            </div>
        </div>
    </div>    



    </body>
</html>
